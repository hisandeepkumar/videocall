<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Video Call Application</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    /* Reset aur Body Styling */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      background: #0b0f1e;
      color: #e0e0e0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      overflow: hidden;
      height: 100vh;
      position: relative;
    }

    /* Gradient Background Animation */
    .gradient-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      background: linear-gradient(120deg, #2a0a4b 0%, #5c0a91 30%, #0a8f91 60%, #0a4b5c 100%);
      background-size: 400% 400%;
      animation: gradientShift 25s ease infinite;
    }
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Container aur Video Container */
    .container {
      display: flex;
      flex-direction: column;
      height: 100vh;
      position: relative;
      overflow: hidden;
    }
    .video-container {
      flex: 1;
      position: relative;
      overflow: visible;
      border-radius: 40px;
      margin: 20px;
      background: rgba(10, 12, 20, 0.4);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      box-shadow: 0 0 8px 2px rgba(255, 255, 255, 0.6), 0 24px 60px rgba(0, 0, 0, 0.4), inset 0 0 0 1px rgba(255, 255, 255, 0.05);
    }

    /* Glowing Border ke Styles */
    .glow-border {
      position: relative;
      width: 100%;
      height: 100%;
      border-radius: 40px;
      z-index: 1;
    }
    .glow-border::before {
      content: '';
      position: absolute;
      top: -8px;
      left: -8px;
      right: -8px;
      bottom: -8px;
      border-radius: 48px;
      background: linear-gradient(130deg, #ff0057, #ff7a00, #00ffe1, #ff00f2, #ff0057);
      background-size: 400%;
      animation: borderGlow 6s linear infinite;
      z-index: -1;
      filter: blur(25px);
    }
    .glow-border::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border-radius: 40px;
      padding: 3px;
      background: linear-gradient(130deg, #ff0057, #ff7a00, #00ffe1, #ff00f2, #ff0057);
      background-size: 400%;
      animation: borderGlow 6s linear infinite;
      z-index: 1;
      -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
    }
    @keyframes borderGlow {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Content ke andar Video */
    .content {
      position: relative;
      z-index: 2;
      width: 100%;
      height: 100%;
      border-radius: 40px;
      overflow: hidden;
      background: #000; /* Solid background taaki neeche kuch na dikhe */
    }

    /* Video Elements */
    #remoteVideo {
      width: 100%;
      height: 100%;
      object-fit: cover;
      background: #000;
    }
    #localVideo {
      height: 160px;
      width: auto;
      max-width: 200px;
      position: absolute;
      bottom: 120px;
      right: 40px;
      border-radius: 24px;
      object-fit: cover;
      z-index: 10;
      background: #000;
      transition: all 0.3s;
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.6);
      cursor: pointer;
    }
    #localVideo:hover {
      transform: scale(1.07);
    }

    /* Controls Styling */
    .controls {
      position: fixed;
      bottom: 22px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 28px;
      z-index: 10;
      background: rgba(15, 18, 28, 0.8);
      padding: 10px 25px;
      border-radius: 54px;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.4);
    }
    .control-btn {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: rgba(20, 24, 36, 0.85);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      color: #e0e0e0;
      font-size: 26px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
    }
    .control-btn:hover {
      background: rgba(30, 34, 50, 0.9);
      transform: translateY(-6px);
      box-shadow: 0 16px 50px rgba(0, 0, 0, 0.5);
    }
    #endBtn {
      background: rgba(200, 30, 50, 0.9);
    }
    #endBtn:hover {
      background: rgba(220, 50, 70, 0.9);
    }
  </style>
</head>
<body>
  <div class="gradient-background"></div>
  <div class="container">
    <div class="video-container glass">
      <!-- Remote Video ke saath Glowing Border -->
      <div class="glow-border">
        <div class="content">
          <video id="remoteVideo" autoplay playsinline></video>
        </div>
      </div>
      <!-- Local Video -->
      <video id="localVideo" autoplay muted playsinline></video>
      <!-- Controls -->
      <div class="controls">
        <div class="control-btn glass" id="muteBtn">
          <i class="fas fa-microphone"></i>
        </div>
        <div class="control-btn glass" id="switchCameraBtn">
          <i class="fas fa-camera"></i>
        </div>
        <div class="control-btn pulse glass" id="endBtn">
          <i class="fas fa-phone-slash"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- PeerJS Library -->
  <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
  <script>
    let peer;
    let localStream;
    let currentCall;
    let isMuted = false;
    let currentCamera = 'user';

    const localVideo = document.getElementById('localVideo');
    const remoteVideo = document.getElementById('remoteVideo');

    // Media Access aur Peer Setup
    async function init() {
      try {
        localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
        localVideo.srcObject = localStream;

        peer = new Peer();

        peer.on('open', (id) => {
          console.log('My Peer ID:', id);
          // Yahan peer ID display ya link generate kar sakte hain
        });

        peer.on('call', (call) => {
          currentCall = call;
          call.answer(localStream);
          call.on('stream', (remoteStream) => {
            remoteVideo.srcObject = remoteStream;
          });
        });
      } catch (err) {
        console.error('Error accessing media devices:', err);
      }
    }

    // Mute/Unmute Functionality
    document.getElementById('muteBtn').addEventListener('click', () => {
      isMuted = !isMuted;
      localStream.getAudioTracks().forEach(track => {
        track.enabled = !isMuted;
      });
      const icon = document.querySelector('#muteBtn i');
      icon.classList.toggle('fa-microphone');
      icon.classList.toggle('fa-microphone-slash');
    });

    // Camera Switch Functionality
    document.getElementById('switchCameraBtn').addEventListener('click', async () => {
      try {
        currentCamera = currentCamera === 'user' ? 'environment' : 'user';
        const newStream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: currentCamera },
          audio: true
        });

        if (currentCall) {
          const videoSender = currentCall.peerConnection.getSenders().find(s => s.track.kind === 'video');
          if (videoSender) {
            videoSender.replaceTrack(newStream.getVideoTracks()[0]);
          }
        }

        localStream.getTracks().forEach(track => track.stop());
        localStream = newStream;
        localVideo.srcObject = localStream;
      } catch (err) {
        console.error('Error switching camera:', err);
      }
    });

    // Call End Functionality
    document.getElementById('endBtn').addEventListener('click', () => {
      if (currentCall) {
        currentCall.close();
      }
      if (peer) {
        peer.destroy();
      }
      localStream.getTracks().forEach(track => track.stop());
      window.close();
    });

    // Application Start
    init();
  </script>
</body>
</html>
