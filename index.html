
  <style>
    /* ----------------------------------------------------------  
       RESET & BODY  
    ---------------------------------------------------------- */  
    * {  
      margin: 0;  
      padding: 0;  
      box-sizing: border-box;  
    }  
    
    body {  
      background: #0b0f1e;  
      color: #e0e0e0;  
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;  
      overflow: hidden;  
      height: 100vh;  
      position: relative;  
    }  

    /* ----------------------------------------------------------  
       ANIMATED GRADIENT BACKGROUND (PURPLE ➔ TEAL)   
    ---------------------------------------------------------- */  
    .gradient-background {  
      position: fixed;  
      top: 0;  
      left: 0;  
      width: 100%;  
      height: 100%;  
      z-index: -1;  
      background: linear-gradient(120deg,  
        #2a0a4b 0%,  
        #5c0a91 30%,  
        #0a8f91 60%,  
        #0a4b5c 100%);  
      background-size: 400% 400%;  
      animation: gradientShift 25s ease infinite;  
    }  

    @keyframes gradientShift {  
      0% { background-position: 0% 50%; }  
      50% { background-position: 100% 50%; }  
      100% { background-position: 0% 50%; }  
    }  

    /* ----------------------------------------------------------  
       MODERN GLASS-STYLE UI ELEMENTS   
    ---------------------------------------------------------- */  
    .container {  
      display: flex;  
      flex-direction: column;  
      height: 100vh;  
      position: relative;  
      overflow: hidden;  
    }  

    .video-container {  
      flex: 1;  
      position: relative;  
      overflow: hidden;  
      border-radius: 24px;  
      margin: 20px;  
      background: rgba(10, 12, 20, 0.4);  
      backdrop-filter: blur(12px);  
      -webkit-backdrop-filter: blur(12px);  
      border: 3px solid rgba(255, 255, 255, 0.8);  
      box-shadow:  
        0 0 8px 2px rgba(255, 255, 255, 0.6),  
        0 24px 60px rgba(0, 0, 0, 0.4),  
        inset 0 0 0 1px rgba(255, 255, 255, 0.05);  
    }  

    /* ----------------------------------------------------------  
       VIDEO ELEMENTS (FULLSCREEN & LOCAL PREVIEW)  
    ---------------------------------------------------------- */  
    #remoteVideo {  
      border: 3px solid rgba(255, 255, 255, 0.8);  
      position: absolute;  
      top: 0;  
      left: 0;  
      width: 100%;  
      height: 100%;  
      object-fit: cover;  
      background: #000;  
      border-radius: 24px;  
      z-index: 1;  
      cursor: default;  
      box-shadow:  
        0 0 12px 4px rgba(255, 255, 255, 0.6),  
        0 12px 40px rgba(0, 0, 0, 0.6);  
    }  

    #localVideo {  
      height: 160px;  
      width: auto;  
      max-width: 200px;  
      position: absolute;  
      bottom: 120px;  
      right: 40px;  
      border-radius: 24px;  
      object-fit: cover;  
      z-index: 10;  
      background: #000;  
      transition: all 0.3s;  
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.6);  
      cursor: pointer;  
    }  

    #localVideo:hover {  
      transform: scale(1.07);  
    }  

    /* ----------------------------------------------------------  
       STATUS BAR (TOP CENTER)  
    ---------------------------------------------------------- */  
    .status {  
      position: fixed;  
      top: 30px;  
      left: 50%;  
      transform: translateX(-50%);  
      padding: 7px 16px;  
      background: rgba(15, 18, 28, 0.75);  
      border-radius: 30px;  
      font-weight: 600;  
      font-size: 15px;  
      z-index: 10;  
      backdrop-filter: blur(12px);  
      -webkit-backdrop-filter: blur(12px);  
      border: 1px solid rgba(255, 255, 255, 0.08);  
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);  
      min-width: 220px;  
      text-align: center;  
      text-transform: uppercase;  
      letter-spacing: 1px;  
      color: #e0e0e0;  
      display: flex;  
      align-items: center;  
      gap: 14px;  
    }  

    .timer {  
      background: rgba(5, 8, 15, 0.6);  
      padding: 6px 16px;  
      border-radius: 22px;  
      font-size: 13px;  
      font-weight: 500;  
      display: flex;  
      align-items: center;  
      gap: 8px;  
      color: #b0e0e6;  
    }  

    .timer i {  
      margin-right: 6px;  
      color: #10f0d8;  
    }  

    /* ----------------------------------------------------------  
       CONTROLS (BOTTOM CENTER)  
    ---------------------------------------------------------- */  
    .controls {  
      position: fixed;  
      bottom: 22px;  
      left: 50%;  
      transform: translateX(-50%);  
      display: flex;  
      gap: 28px;  
      z-index: 10;  
      background: rgba(15, 18, 28, 0.8);  
      padding: 10px 25px;  
      border-radius: 54px;  
      backdrop-filter: blur(14px);  
      -webkit-backdrop-filter: blur(14px);  
      border: 1px solid rgba(255, 255, 255, 0.08);  
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.4);  
    }  

    .control-btn {  
      width: 70px;  
      height: 70px;  
      border-radius: 50%;  
      background: rgba(20, 24, 36, 0.85);  
      backdrop-filter: blur(10px);  
      -webkit-backdrop-filter: blur(10px);  
      border: 1px solid rgba(255, 255, 255, 0.08);  
      color: #e0e0e0;  
      font-size: 26px;  
      display: flex;  
      justify-content: center;  
      align-items: center;  
      cursor: pointer;  
      transition: all 0.3s ease;  
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);  
    }  

    .control-btn:hover {  
      background: rgba(30, 34, 50, 0.9);  
      transform: translateY(-6px);  
      box-shadow: 0 16px 50px rgba(0, 0, 0, 0.5);  
    }  

    .control-btn:active {  
      transform: translateY(0) scale(0.94);  
    }  

    #endBtn {  
      background: rgba(200, 30, 50, 0.9);  
    }  

    #endBtn:hover {  
      background: rgba(220, 50, 70, 0.9);  
    }  

    /* ----------------------------------------------------------  
       FULLSCREEN BUTTON (TOP RIGHT)  
    ---------------------------------------------------------- */  
    .fullscreen-btn {  
      position: fixed;  
      top: 32px;  
      right: 32px;  
      width: 42px;  
      height: 42px;  
      border-radius: 50%;  
      background: rgba(20, 24, 36, 0.85);  
      border: 1px solid rgba(255, 255, 255, 0.08);  
      color: #e0e0e0;  
      display: flex;  
      align-items: center;  
      justify-content: center;  
      font-size: 22px;  
      cursor: pointer;  
      z-index: 10;  
      transition: all 0.3s;  
      backdrop-filter: blur(10px);  
      -webkit-backdrop-filter: blur(10px);  
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);  
    }  

    .fullscreen-btn:hover {  
      background: rgba(30, 34, 50, 0.9);  
      transform: scale(1.12);  
    }  

    /* ----------------------------------------------------------  
       NOTIFICATION BANNER (TOP CENTER)  
    ---------------------------------------------------------- */  
    .notification {  
      position: fixed;  
      top: 20px;  
      left: 50%;  
      transform: translateX(-50%);  
      background: rgba(20, 150, 150, 0.9);  
      color: #ffffff;  
      padding: 14px 32px;  
      border-radius: 30px;  
      z-index: 100;  
      opacity: 0;  
      transition: opacity 0.3s ease;  
      backdrop-filter: blur(12px);  
      -webkit-backdrop-filter: blur(12px);  
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);  
      font-weight: 500;  
      font-size: 16px;  
      letter-spacing: 0.5px;  
    }  

    .notification.show {  
      opacity: 1;  
    }  

    /* ----------------------------------------------------------  
       CONNECTION STATUS INDICATOR  
    ---------------------------------------------------------- */  
    .connection-status {  
      display: flex;  
      align-items: center;  
      gap: 10px;  
    }  

    .status-indicator {  
      width: 12px;  
      height: 12px;  
      border-radius: 50%;  
      background: #e04b4b;  
      box-shadow: 0 0 15px #e04b4b;  
    }  

    .status-indicator.connected {  
      background: #10f0d8;  
      box-shadow: 0 0 15px #10f0d8;  
    }  

    /* ----------------------------------------------------------  
       GLASS EFFECT UTILITIES  
    ---------------------------------------------------------- */  
    .glass {    
      background: rgba(20, 24, 36, 0.85);    
      backdrop-filter: blur(14px);    
      -webkit-backdrop-filter: blur(14px);    
      border: 1px solid rgba(255, 255, 255, 0.08);    
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.4);    
    }  

    /* ----------------------------------------------------------  
       COPY BUTTON STYLE  
    ---------------------------------------------------------- */  
    .copy-btn {  
      background: linear-gradient(to right, #0cfbd8, #0a8f91);  
      border: none;  
      color: #ffffff;  
      padding: 14px 32px;  
      border-radius: 30px;  
      cursor: pointer;  
      font-weight: 600;  
      transition: all 0.3s;  
      display: flex;  
      align-items: center;  
      justify-content: center;  
      gap: 12px;  
      box-shadow: 0 12px 40px rgba(10, 132, 255, 0.4);  
      letter-spacing: 0.5px;  
      font-size: 16px;  
      backdrop-filter: blur(10px);  
      -webkit-backdrop-filter: blur(10px);  
    }  

    .copy-btn:hover {  
      transform: translateY(-3px);  
      box-shadow: 0 15px 50px rgba(10, 132, 255, 0.6);  
      background: linear-gradient(to right, #10f0d8, #0a4b5c);  
    }  

    /* ----------------------------------------------------------  
       CONNECTION INFO STYLE  
    ---------------------------------------------------------- */  
    .connection-info {  
      position: fixed;  
      top: 80px;  
      left: 50%;  
      transform: translateX(-50%);  
      padding: 0;  
      border-radius: 0;  
      font-size: 14px;  
      z-index: 10;  
      backdrop-filter: none;  
      border: none;  
      text-align: center;  
      max-width: 80%;  
      box-shadow: none;  
      color: #e0e0e0;  
    }  

    /* ----------------------------------------------------------  
       ANIMATED PULSE FOR CALL BUTTON  
    ---------------------------------------------------------- */  
    .pulse {  
      animation: pulseAnimation 2s infinite;  
    }  

    @keyframes pulseAnimation {  
      0% {  
        box-shadow: 0 0 0 0 rgba(200, 30, 50, 0.7);  
      }  
      70% {  
        box-shadow: 0 0 0 20px rgba(200, 30, 50, 0);  
      }  
      100% {  
        box-shadow: 0 0 0 0 rgba(200, 30, 50, 0);  
      }  
    }  

    /* ----------------------------------------------------------  
       LOADING SPINNER  
    ---------------------------------------------------------- */  
    .spinner {  
      position: fixed;  
      top: 50%;  
      left: 50%;  
      transform: translate(-50%, -50%);  
      width: 60px;  
      height: 60px;  
      border-radius: 50%;  
      border: 4px solid rgba(255, 255, 255, 0.1);  
      border-top: 4px solid #0cfbd8;  
      animation: spin 1s linear infinite;  
      z-index: 20;  
    }  

    @keyframes spin {  
      0% { transform: translate(-50%, -50%) rotate(0deg); }  
      100% { transform: translate(-50%, -50%) rotate(360deg); }  
    }  

    /* ----------------------------------------------------------  
       TYPOGRAPHY  
    ---------------------------------------------------------- */  
    h1, h2, h3, h4, h5, h6 {  
      font-weight: 600;  
      letter-spacing: -0.5px;  
    }  

    /* ----------------------------------------------------------  
       AUDIO PROCESSING PANEL  
    ---------------------------------------------------------- */  
    .audio-panel {
      position: fixed;
      top: 80px;
      right: 20px;
      background: rgba(15, 18, 28, 0.8);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 16px;
      padding: 20px;
      width: 300px;
      z-index: 20;
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.4);
    }
    
    .audio-panel h3 {
      margin-bottom: 15px;
      color: #10f0d8;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .audio-panel h3 i {
      font-size: 20px;
    }
    
    .audio-control {
      margin-bottom: 15px;
    }
    
    .audio-control label {
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
      color: #b0e0e6;
    }
    
    .audio-control input[type="range"] {
      width: 100%;
      height: 6px;
      background: rgba(10, 12, 20, 0.6);
      border-radius: 3px;
      outline: none;
      -webkit-appearance: none;
    }
    
    .audio-control input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #10f0d8;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(16, 240, 216, 0.6);
    }
    
    .audio-visualizer {
      height: 100px;
      background: rgba(10, 12, 20, 0.4);
      border-radius: 8px;
      margin-top: 10px;
      overflow: hidden;
      position: relative;
    }
    
    .visualizer-bars {
      display: flex;
      align-items: flex-end;
      justify-content: space-around;
      height: 100%;
      padding: 10px;
    }
    
    .bar {
      width: 8px;
      background: linear-gradient(to top, #10f0d8, #0a8f91);
      border-radius: 4px 4px 0 0;
      transition: height 0.1s ease;
    }
    
    .audio-presets {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    
    .preset-btn {
      flex: 1;
      background: rgba(20, 24, 36, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: #e0e0e0;
      padding: 8px 5px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s;
    }
    
    .preset-btn:hover {
      background: rgba(30, 34, 50, 0.8);
      border-color: rgba(16, 240, 216, 0.5);
    }
    
    .preset-btn.active {
      background: rgba(16, 240, 216, 0.2);
      border-color: #10f0d8;
      color: #10f0d8;
    }
    
    .quality-indicator {
      display: flex;
      align-items: center;
      margin-top: 15px;
      font-size: 13px;
      gap: 8px;
    }
    
    .quality-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #e04b4b;
    }
    
    .quality-dot.good {
      background: #4be06d;
    }
    
    .quality-dot.excellent {
      background: #10f0d8;
      box-shadow: 0 0 10px #10f0d8;
    }

    /* ----------------------------------------------------------  
       RESPONSIVE ADJUSTMENTS  
    ---------------------------------------------------------- */  
    @media (max-width: 768px) {  
      .controls {  
        gap: 18px;  
        padding: 15px 24px;  
      }  
        
      .control-btn {  
        width: 64px;  
        height: 64px;  
        font-size: 22px;  
      }  
        
      .status {  
        padding: 10px 20px;  
        font-size: 13px;  
      }  
        
      .fullscreen-btn {  
        width: 36px;  
        height: 36px;  
        font-size: 18px;  
      }  
        
      #localVideo {  
        bottom: 100px;  
        right: 20px;  
      }  
      
      .audio-panel {
        top: auto;
        bottom: 160px;
        right: 50%;
        transform: translateX(50%);
        width: 90%;
      }
    }
  </style>  


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quantum Video Call - Premium Audio Processing</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
 
    /* ----------------------------------------------------------  
       RESET & BODY  
    ---------------------------------------------------------- */  
    * {  
      margin: 0;  
      padding: 0;  
      box-sizing: border-box;  
    }  
    
    body {  
      background: #0b0f1e;  
      color: #e0e0e0;  
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;  
      overflow: hidden;  
      height: 100vh;  
      position: relative;  
    }  

    /* ----------------------------------------------------------  
       ANIMATED GRADIENT BACKGROUND (PURPLE ➔ TEAL)   
    ---------------------------------------------------------- */  
    .gradient-background {  
      position: fixed;  
      top: 0;  
      left: 0;  
      width: 100%;  
      height: 100%;  
      z-index: -1;  
      background: linear-gradient(120deg,  
        #2a0a4b 0%,  
        #5c0a91 30%,  
        #0a8f91 60%,  
        #0a4b5c 100%);  
      background-size: 400% 400%;  
      animation: gradientShift 25s ease infinite;  
    }  

    @keyframes gradientShift {  
      0% { background-position: 0% 50%; }  
      50% { background-position: 100% 50%; }  
      100% { background-position: 0% 50%; }  
    }  

    /* ----------------------------------------------------------  
       MODERN GLASS-STYLE UI ELEMENTS   
    ---------------------------------------------------------- */  
    .container {  
      display: flex;  
      flex-direction: column;  
      height: 100vh;  
      position: relative;  
      overflow: hidden;  
    }  

    .video-container {  
      flex: 1;  
      position: relative;  
      overflow: hidden;  
      border-radius: 24px;  
      margin: 20px;  
      background: rgba(10, 12, 20, 0.4);  
      backdrop-filter: blur(12px);  
      -webkit-backdrop-filter: blur(12px);  
      border: 3px solid rgba(255, 255, 255, 0.8);  
      box-shadow:  
        0 0 8px 2px rgba(255, 255, 255, 0.6),  
        0 24px 60px rgba(0, 0, 0, 0.4),  
        inset 0 0 0 1px rgba(255, 255, 255, 0.05);  
    }  

    /* ----------------------------------------------------------  
       VIDEO ELEMENTS (FULLSCREEN & LOCAL PREVIEW)  
    ---------------------------------------------------------- */  
    #remoteVideo {  
      border: 3px solid rgba(255, 255, 255, 0.8);  
      position: absolute;  
      top: 0;  
      left: 0;  
      width: 100%;  
      height: 100%;  
      object-fit: cover;  
      background: #000;  
      border-radius: 24px;  
      z-index: 1;  
      cursor: default;  
      box-shadow:  
        0 0 12px 4px rgba(255, 255, 255, 0.6),  
        0 12px 40px rgba(0, 0, 0, 0.6);  
    }  

    #localVideo {  
      height: 160px;  
      width: auto;  
      max-width: 200px;  
      position: absolute;  
      bottom: 120px;  
      right: 40px;  
      border-radius: 24px;  
      object-fit: cover;  
      z-index: 10;  
      background: #000;  
      transition: all 0.3s;  
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.6);  
      cursor: pointer;  
    }  

    #localVideo:hover {  
      transform: scale(1.07);  
    }  

    /* ----------------------------------------------------------  
       STATUS BAR (TOP CENTER)  
    ---------------------------------------------------------- */  
    .status {  
      position: fixed;  
      top: 30px;  
      left: 50%;  
      transform: translateX(-50%);  
      padding: 7px 16px;  
      background: rgba(15, 18, 28, 0.75);  
      border-radius: 30px;  
      font-weight: 600;  
      font-size: 15px;  
      z-index: 10;  
      backdrop-filter: blur(12px);  
      -webkit-backdrop-filter: blur(12px);  
      border: 1px solid rgba(255, 255, 255, 0.08);  
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);  
      min-width: 220px;  
      text-align: center;  
      text-transform: uppercase;  
      letter-spacing: 1px;  
      color: #e0e0e0;  
      display: flex;  
      align-items: center;  
      gap: 14px;  
    }  

    .timer {  
      background: rgba(5, 8, 15, 0.6);  
      padding: 6px 16px;  
      border-radius: 22px;  
      font-size: 13px;  
      font-weight: 500;  
      display: flex;  
      align-items: center;  
      gap: 8px;  
      color: #b0e0e6;  
    }  

    .timer i {  
      margin-right: 6px;  
      color: #10f0d8;  
    }  

    /* ----------------------------------------------------------  
       CONTROLS (BOTTOM CENTER)  
    ---------------------------------------------------------- */  
    .controls {  
      position: fixed;  
      bottom: 22px;  
      left: 50%;  
      transform: translateX(-50%);  
      display: flex;  
      gap: 28px;  
      z-index: 10;  
      background: rgba(15, 18, 28, 0.8);  
      padding: 10px 25px;  
      border-radius: 54px;  
      backdrop-filter: blur(14px);  
      -webkit-backdrop-filter: blur(14px);  
      border: 1px solid rgba(255, 255, 255, 0.08);  
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.4);  
    }  

    .control-btn {  
      width: 70px;  
      height: 70px;  
      border-radius: 50%;  
      background: rgba(20, 24, 36, 0.85);  
      backdrop-filter: blur(10px);  
      -webkit-backdrop-filter: blur(10px);  
      border: 1px solid rgba(255, 255, 255, 0.08);  
      color: #e0e0e0;  
      font-size: 26px;  
      display: flex;  
      justify-content: center;  
      align-items: center;  
      cursor: pointer;  
      transition: all 0.3s ease;  
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);  
    }  

    .control-btn:hover {  
      background: rgba(30, 34, 50, 0.9);  
      transform: translateY(-6px);  
      box-shadow: 0 16px 50px rgba(0, 0, 0, 0.5);  
    }  

    .control-btn:active {  
      transform: translateY(0) scale(0.94);  
    }  

    #endBtn {  
      background: rgba(200, 30, 50, 0.9);  
    }  

    #endBtn:hover {  
      background: rgba(220, 50, 70, 0.9);  
    }  

    /* ----------------------------------------------------------  
       FULLSCREEN BUTTON (TOP RIGHT)  
    ---------------------------------------------------------- */  
    .fullscreen-btn {  
      position: fixed;  
      top: 32px;  
      right: 32px;  
      width: 42px;  
      height: 42px;  
      border-radius: 50%;  
      background: rgba(20, 24, 36, 0.85);  
      border: 1px solid rgba(255, 255, 255, 0.08);  
      color: #e0e0e0;  
      display: flex;  
      align-items: center;  
      justify-content: center;  
      font-size: 22px;  
      cursor: pointer;  
      z-index: 10;  
      transition: all 0.3s;  
      backdrop-filter: blur(10px);  
      -webkit-backdrop-filter: blur(10px);  
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);  
    }  

    .fullscreen-btn:hover {  
      background: rgba(30, 34, 50, 0.9);  
      transform: scale(1.12);  
    }  

    /* ----------------------------------------------------------  
       NOTIFICATION BANNER (TOP CENTER)  
    ---------------------------------------------------------- */  
    .notification {  
      position: fixed;  
      top: 20px;  
      left: 50%;  
      transform: translateX(-50%);  
      background: rgba(20, 150, 150, 0.9);  
      color: #ffffff;  
      padding: 14px 32px;  
      border-radius: 30px;  
      z-index: 100;  
      opacity: 0;  
      transition: opacity 0.3s ease;  
      backdrop-filter: blur(12px);  
      -webkit-backdrop-filter: blur(12px);  
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);  
      font-weight: 500;  
      font-size: 16px;  
      letter-spacing: 0.5px;  
    }  

    .notification.show {  
      opacity: 1;  
    }  

    /* ----------------------------------------------------------  
       CONNECTION STATUS INDICATOR  
    ---------------------------------------------------------- */  
    .connection-status {  
      display: flex;  
      align-items: center;  
      gap: 10px;  
    }  

    .status-indicator {  
      width: 12px;  
      height: 12px;  
      border-radius: 50%;  
      background: #e04b4b;  
      box-shadow: 0 0 15px #e04b4b;  
    }  

    .status-indicator.connected {  
      background: #10f0d8;  
      box-shadow: 0 0 15px #10f0d8;  
    }  

    /* ----------------------------------------------------------  
       GLASS EFFECT UTILITIES  
    ---------------------------------------------------------- */  
    .glass {    
      background: rgba(20, 24, 36, 0.85);    
      backdrop-filter: blur(14px);    
      -webkit-backdrop-filter: blur(14px);    
      border: 1px solid rgba(255, 255, 255, 0.08);    
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.4);    
    }  

    /* ----------------------------------------------------------  
       COPY BUTTON STYLE  
    ---------------------------------------------------------- */  
    .copy-btn {  
      background: linear-gradient(to right, #0cfbd8, #0a8f91);  
      border: none;  
      color: #ffffff;  
      padding: 14px 32px;  
      border-radius: 30px;  
      cursor: pointer;  
      font-weight: 600;  
      transition: all 0.3s;  
      display: flex;  
      align-items: center;  
      justify-content: center;  
      gap: 12px;  
      box-shadow: 0 12px 40px rgba(10, 132, 255, 0.4);  
      letter-spacing: 0.5px;  
      font-size: 16px;  
      backdrop-filter: blur(10px);  
      -webkit-backdrop-filter: blur(10px);  
    }  

    .copy-btn:hover {  
      transform: translateY(-3px);  
      box-shadow: 0 15px 50px rgba(10, 132, 255, 0.6);  
      background: linear-gradient(to right, #10f0d8, #0a4b5c);  
    }  

    /* ----------------------------------------------------------  
       CONNECTION INFO STYLE  
    ---------------------------------------------------------- */  
    .connection-info {  
      position: fixed;  
      top: 80px;  
      left: 50%;  
      transform: translateX(-50%);  
      padding: 0;  
      border-radius: 0;  
      font-size: 14px;  
      z-index: 10;  
      backdrop-filter: none;  
      border: none;  
      text-align: center;  
      max-width: 80%;  
      box-shadow: none;  
      color: #e0e0e0;  
    }  

    /* ----------------------------------------------------------  
       ANIMATED PULSE FOR CALL BUTTON  
    ---------------------------------------------------------- */  
    .pulse {  
      animation: pulseAnimation 2s infinite;  
    }  

    @keyframes pulseAnimation {  
      0% {  
        box-shadow: 0 0 0 0 rgba(200, 30, 50, 0.7);  
      }  
      70% {  
        box-shadow: 0 0 0 20px rgba(200, 30, 50, 0);  
      }  
      100% {  
        box-shadow: 0 0 0 0 rgba(200, 30, 50, 0);  
      }  
    }  

    /* ----------------------------------------------------------  
       LOADING SPINNER  
    ---------------------------------------------------------- */  
    .spinner {  
      position: fixed;  
      top: 50%;  
      left: 50%;  
      transform: translate(-50%, -50%);  
      width: 60px;  
      height: 60px;  
      border-radius: 50%;  
      border: 4px solid rgba(255, 255, 255, 0.1);  
      border-top: 4px solid #0cfbd8;  
      animation: spin 1s linear infinite;  
      z-index: 20;  
    }  

    @keyframes spin {  
      0% { transform: translate(-50%, -50%) rotate(0deg); }  
      100% { transform: translate(-50%, -50%) rotate(360deg); }  
    }  

    /* ----------------------------------------------------------  
       TYPOGRAPHY  
    ---------------------------------------------------------- */  
    h1, h2, h3, h4, h5, h6 {  
      font-weight: 600;  
      letter-spacing: -0.5px;  
    }  

    /* ----------------------------------------------------------  
       AUDIO PROCESSING PANEL  
    ---------------------------------------------------------- */  
    .audio-panel {
      position: fixed;
      top: 80px;
      right: 20px;
      background: rgba(15, 18, 28, 0.8);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 16px;
      padding: 20px;
      width: 300px;
      z-index: 20;
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.4);
    }
    
    .audio-panel h3 {
      margin-bottom: 15px;
      color: #10f0d8;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .audio-panel h3 i {
      font-size: 20px;
    }
    
    .audio-control {
      margin-bottom: 15px;
    }
    
    .audio-control label {
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
      color: #b0e0e6;
    }
    
    .audio-control input[type="range"] {
      width: 100%;
      height: 6px;
      background: rgba(10, 12, 20, 0.6);
      border-radius: 3px;
      outline: none;
      -webkit-appearance: none;
    }
    
    .audio-control input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #10f0d8;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(16, 240, 216, 0.6);
    }
    
    .audio-visualizer {
      height: 100px;
      background: rgba(10, 12, 20, 0.4);
      border-radius: 8px;
      margin-top: 10px;
      overflow: hidden;
      position: relative;
    }
    
    .visualizer-bars {
      display: flex;
      align-items: flex-end;
      justify-content: space-around;
      height: 100%;
      padding: 10px;
    }
    
    .bar {
      width: 8px;
      background: linear-gradient(to top, #10f0d8, #0a8f91);
      border-radius: 4px 4px 0 0;
      transition: height 0.1s ease;
    }
    
    .audio-presets {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    
    .preset-btn {
      flex: 1;
      background: rgba(20, 24, 36, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: #e0e0e0;
      padding: 8px 5px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s;
    }
    
    .preset-btn:hover {
      background: rgba(30, 34, 50, 0.8);
      border-color: rgba(16, 240, 216, 0.5);
    }
    
    .preset-btn.active {
      background: rgba(16, 240, 216, 0.2);
      border-color: #10f0d8;
      color: #10f0d8;
    }
    
    .quality-indicator {
      display: flex;
      align-items: center;
      margin-top: 15px;
      font-size: 13px;
      gap: 8px;
    }
    
    .quality-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #e04b4b;
    }
    
    .quality-dot.good {
      background: #4be06d;
    }
    
    .quality-dot.excellent {
      background: #10f0d8;
      box-shadow: 0 0 10px #10f0d8;
    }

    /* ----------------------------------------------------------  
       RESPONSIVE ADJUSTMENTS  
    ---------------------------------------------------------- */  
    @media (max-width: 768px) {  
      .controls {  
        gap: 18px;  
        padding: 15px 24px;  
      }  
        
      .control-btn {  
        width: 64px;  
        height: 64px;  
        font-size: 22px;  
      }  
        
      .status {  
        padding: 10px 20px;  
        font-size: 13px;  
      }  
        
      .fullscreen-btn {  
        width: 36px;  
        height: 36px;  
        font-size: 18px;  
      }  
        
      #localVideo {  
        bottom: 100px;  
        right: 20px;  
      }  
      
      .audio-panel {
        top: auto;
        bottom: 160px;
        right: 50%;
        transform: translateX(50%);
        width: 90%;
      }
    }
  
  </style>  
</head>  
<body>  
  <div class="gradient-background"></div>  
  <div class="notification" id="notification">  
    Link copied to clipboard!  
  </div>  
    
  <div class="spinner" id="spinner"></div>  
    
  <div class="container">  
    <!-- STATUS BAR (top center) -->  
    <div class="status glass" id="status">  
      <div class="connection-status">  
        <div class="status-indicator" id="statusIndicator"></div>  
        <span id="statusText">CONNECTING</span>  
      </div>  
      <div class="timer" id="timer" style="display: none;">  
        <i class="fas fa-clock"></i>  
        <span id="timerDisplay">00:00:00</span>  
      </div>  
    </div>  
    
    <!-- AUDIO PROCESSING PANEL -->
    <div class="audio-panel glass">
      <h3><i class="fas fa-wave-square"></i> Audio Processing</h3>
      
      <div class="audio-control">
        <label for="noiseSuppression">Noise Suppression: <span id="noiseValue">85%</span></label>
        <input type="range" id="noiseSuppression" min="0" max="100" value="85">
      </div>
      
      <div class="audio-control">
        <label for="voiceClarity">Voice Clarity: <span id="clarityValue">90%</span></label>
        <input type="range" id="voiceClarity" min="0" max="100" value="90">
      </div>
      
      <div class="audio-control">
        <label for="bassBoost">Bass Boost: <span id="bassValue">20%</span></label>
        <input type="range" id="bassBoost" min="0" max="100" value="20">
      </div>
      
      <div class="audio-visualizer">
        <div class="visualizer-bars" id="visualizer"></div>
      </div>
      
      <div class="quality-indicator">
        <div class="quality-dot excellent" id="qualityDot"></div>
        <span id="qualityText">Audio Quality: Excellent</span>
      </div>
      
      <div class="audio-presets">
        <button class="preset-btn active" data-preset="default">Default</button>
        <button class="preset-btn" data-preset="meeting">Meeting</button>
        <button class="preset-btn" data-preset="music">Music</button>
        <button class="preset-btn" data-preset="outdoor">Outdoor</button>
      </div>
    </div>
    
    <!-- CONNECTION INFO -->  
    <div class="connection-info" id="connectionInfo"></div>  

    <!-- FULLSCREEN TOGGLE (top right) -->  
    <div class="fullscreen-btn glass" id="fullscreenBtn">  
      <i class="fas fa-expand"></i>  
    </div>  
    
    <div class="video-container glass">  
      <!-- Remote video (fills glass container) -->  
      <video id="remoteVideo" autoplay playsinline></video>  

      <!-- Local video (corner preview, tap to swap) -->  
      <video id="localVideo" autoplay muted playsinline></video>  
        
      <!-- CONTROLS (bottom center) -->  
      <div class="controls">  
        <div class="control-btn glass" id="switchCameraBtn">  
          <i class="fas fa-camera"></i>  
        </div>  
        <div class="control-btn glass" id="muteBtn">  
          <i class="fas fa-microphone"></i>  
        </div>  
        <div class="control-btn pulse glass" id="endBtn">  
          <i class="fas fa-phone-slash"></i>  
        </div>  
      </div>  
    </div>
  </div>    
  
  <!-- PeerJS library -->    
  <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>    
  
  <script>  
    // Audio processing constants
    const AUDIO_PROFILES = {
      default: { noise: 85, clarity: 90, bass: 20 },
      meeting: { noise: 95, clarity: 95, bass: 10 },
      music: { noise: 70, clarity: 85, bass: 50 },
      outdoor: { noise: 98, clarity: 92, bass: 15 }
    };
    
    // Global variables
    const MAX_RETRIES = 3;  
    const RETRY_DELAY = 3000;  
    let peer;  
    let localStream;  
    let remoteStream = null;  
    let currentCall;  
    let isMuted = false;  
    let currentCamera = 'user';  
    let connectionRetries = 0;  
    let callStartTime = 0;  
    let timerInterval = null;  
    let closeConn = null;  
    let generatedPeerId = null;  
    let isSwapped = false;  
    let audioContext = null;
    let audioSource = null;
    let audioDestination = null;
    let visualizerInterval = null;
    let audioProcessingActive = true;

    // DOM elements
    const localVideo = document.getElementById('localVideo');  
    const remoteVideo = document.getElementById('remoteVideo');  
    const statusText = document.getElementById('statusText');  
    const statusIndicator = document.getElementById('statusIndicator');  
    const timerDisplay = document.getElementById('timerDisplay');  
    const timerEl = document.getElementById('timer');  
    const fullscreenBtn = document.getElementById('fullscreenBtn');  
    const connectionInfo = document.getElementById('connectionInfo');  
    const notification = document.getElementById('notification');  
    const spinner = document.getElementById('spinner');  
    const visualizer = document.getElementById('visualizer');
    const noiseSuppression = document.getElementById('noiseSuppression');
    const voiceClarity = document.getElementById('voiceClarity');
    const bassBoost = document.getElementById('bassBoost');
    const noiseValue = document.getElementById('noiseValue');
    const clarityValue = document.getElementById('clarityValue');
    const bassValue = document.getElementById('bassValue');
    const qualityDot = document.getElementById('qualityDot');
    const qualityText = document.getElementById('qualityText');
    const presetButtons = document.querySelectorAll('.preset-btn');

    // Swap videos when local video is tapped  
    localVideo.addEventListener('click', () => {  
      if (!remoteStream) return;  
      isSwapped = !isSwapped;  
      if (isSwapped) {  
        remoteVideo.srcObject = localStream;  
        localVideo.srcObject = remoteStream;  
      } else {  
        remoteVideo.srcObject = remoteStream;  
        localVideo.srcObject = localStream;  
      }  
    });  

    function showNotification(message) {  
      notification.textContent = message;  
      notification.classList.add('show');  
      setTimeout(() => {  
        notification.classList.remove('show');  
      }, 2000);  
    }  

    function updateStatus(status, isConnected = false) {  
      statusText.textContent = status;  
      if (isConnected) {  
        statusIndicator.classList.add('connected');  
        statusIndicator.style.background = '#10f0d8';  
        statusIndicator.style.boxShadow = '0 0 15px #10f0d8';  
      } else {  
        statusIndicator.classList.remove('connected');  
        statusIndicator.style.background = '#e04b4b';  
        statusIndicator.style.boxShadow = '0 0 15px #e04b4b';  
      }  
    }  

    function startTimer() {  
      callStartTime = Date.now();  
      timerEl.style.display = 'flex';  
      timerInterval = setInterval(() => {  
        const elapsed = Date.now() - callStartTime;  
        const hours = Math.floor(elapsed / 3600000);  
        const minutes = Math.floor((elapsed % 3600000) / 60000);  
        const seconds = Math.floor((elapsed % 60000) / 1000);  
        timerDisplay.textContent =  
          `${hours.toString().padStart(2, '0')}:` +  
          `${minutes.toString().padStart(2, '0')}:` +  
          `${seconds.toString().padStart(2, '0')}`;  
      }, 1000);  
    }  

    function stopTimer() {  
      if (timerInterval) {  
        clearInterval(timerInterval);  
        timerInterval = null;  
      }  
      timerEl.style.display = 'none';  
    }  
    
    // Custom audio processing algorithm
    function applyAudioProcessing(stream) {
      // Create audio context if not exists
      if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
      }
      
      // Create audio source from stream
      audioSource = audioContext.createMediaStreamSource(stream);
      
      // Create destination to output processed audio
      audioDestination = audioContext.createMediaStreamDestination();
      
      // Create processing nodes
      const analyser = audioContext.createAnalyser();
      analyser.fftSize = 256;
      
      // Create noise suppression
      const noiseSuppressionNode = audioContext.createBiquadFilter();
      noiseSuppressionNode.type = 'highpass';
      noiseSuppressionNode.frequency.value = 100;
      
      // Create voice clarity enhancement
      const clarityNode = audioContext.createBiquadFilter();
      clarityNode.type = 'peaking';
      clarityNode.frequency.value = 1500;
      clarityNode.gain.value = 10;
      clarityNode.Q.value = 1.0;
      
      // Create bass boost
      const bassNode = audioContext.createBiquadFilter();
      bassNode.type = 'lowshelf';
      bassNode.frequency.value = 200;
      bassNode.gain.value = 5;
      
      // Create compressor for consistent volume
      const compressor = audioContext.createDynamicsCompressor();
      compressor.threshold.value = -50;
      compressor.knee.value = 10;
      compressor.ratio.value = 12;
      compressor.attack.value = 0.01;
      compressor.release.value = 0.1;
      
      // Connect nodes: source -> noise suppression -> clarity -> bass -> compressor -> destination
      audioSource.connect(noiseSuppressionNode);
      noiseSuppressionNode.connect(clarityNode);
      clarityNode.connect(bassNode);
      bassNode.connect(compressor);
      compressor.connect(analyser);
      analyser.connect(audioDestination);
      
      // Start visualization
      startVisualization(analyser);
      
      // Return processed audio stream
      return audioDestination.stream;
    }
    
    function startVisualization(analyser) {
      // Clear any existing visualization
      if (visualizerInterval) {
        clearInterval(visualizerInterval);
      }
      
      // Create bars for visualization
      visualizer.innerHTML = '';
      const barCount = 20;
      const bars = [];
      
      for (let i = 0; i < barCount; i++) {
        const bar = document.createElement('div');
        bar.className = 'bar';
        bar.style.height = '5px';
        visualizer.appendChild(bar);
        bars.push(bar);
      }
      
      // Create buffer for frequency data
      const bufferLength = analyser.frequencyBinCount;
      const dataArray = new Uint8Array(bufferLength);
      
      // Update visualization
      visualizerInterval = setInterval(() => {
        analyser.getByteFrequencyData(dataArray);
        
        for (let i = 0; i < barCount; i++) {
          const value = dataArray[Math.floor(i * bufferLength / barCount)];
          const height = Math.max(5, value / 255 * 100);
          bars[i].style.height = height + 'px';
        }
      }, 100);
    }
    
    function updateAudioProcessing() {
      if (!audioProcessingActive) return;
      
      const noiseLevel = parseInt(noiseSuppression.value);
      const clarityLevel = parseInt(voiceClarity.value);
      const bassLevel = parseInt(bassBoost.value);
      
      // Update noise suppression
      const noiseNode = audioContext.createBiquadFilter();
      noiseNode.type = 'highpass';
      noiseNode.frequency.value = 80 + (noiseLevel * 1.2);
      
      // Update clarity enhancement
      const clarityNode = audioContext.createBiquadFilter();
      clarityNode.type = 'peaking';
      clarityNode.frequency.value = 1000 + (clarityLevel * 40);
      clarityNode.gain.value = 5 + (clarityLevel * 0.1);
      clarityNode.Q.value = 1.0;
      
      // Update bass boost
      const bassNode = audioContext.createBiquadFilter();
      bassNode.type = 'lowshelf';
      bassNode.frequency.value = 150 + (bassLevel * 3);
      bassNode.gain.value = bassLevel * 0.5;
      
      // Update UI values
      noiseValue.textContent = noiseLevel + '%';
      clarityValue.textContent = clarityLevel + '%';
      bassValue.textContent = bassLevel + '%';
      
      // Update audio quality indicator
      const totalQuality = noiseLevel + clarityLevel + (bassLevel / 2);
      if (totalQuality > 220) {
        qualityDot.className = 'quality-dot excellent';
        qualityText.textContent = 'Audio Quality: Excellent';
      } else if (totalQuality > 180) {
        qualityDot.className = 'quality-dot good';
        qualityText.textContent = 'Audio Quality: Good';
      } else {
        qualityDot.className = 'quality-dot';
        qualityText.textContent = 'Audio Quality: Fair';
      }
    }
    
    function applyAudioProfile(profile) {
      const settings = AUDIO_PROFILES[profile];
      noiseSuppression.value = settings.noise;
      voiceClarity.value = settings.clarity;
      bassBoost.value = settings.bass;
      updateAudioProcessing();
      
      // Update active button
      presetButtons.forEach(btn => {
        if (btn.dataset.preset === profile) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });
    }

    async function getMedia(cameraFacingMode = 'user') {  
      try {  
        // Enhanced audio constraints for crystal-clear quality  
        const stream = await navigator.mediaDevices.getUserMedia({  
          video: {  
            width: { ideal: 1280 },  
            height: { ideal: 720 },  
            frameRate: { ideal: 60 },  
            facingMode: cameraFacingMode  
          },  
          audio: {  
            echoCancellation: true,  
            noiseSuppression: true,  
            autoGainControl: true,  
            channelCount: 1,  
            sampleRate: 48000,  
            sampleSize: 24,  
            latency: 0,  
            volume: 1.0
          }  
        });
        
        // Apply custom audio processing
        if (audioProcessingActive) {
          return applyAudioProcessing(stream);
        }
        
        return stream;
      } catch (err) {  
        console.error('Error accessing media devices:', err);  
        connectionInfo.innerHTML =  
          'Failed to access camera and microphone. Please check permissions.';  
        throw err;  
      }  
    }  

    async function init() {  
      updateStatus('CONNECTING');  
      spinner.style.display = 'block';  

      const urlParams = new URLSearchParams(window.location.search);  
      const code = urlParams.get('code');  

      try {  
        localStream = await getMedia();  
        localVideo.srcObject = localStream;  

        if (code) {  
          // Receiver  
          generatedPeerId = code;  
          connectionInfo.innerHTML = '';  
          setupReceiver(code);  
        } else {  
          // Caller - FIXED: Create copy button properly
          generatedPeerId = generateId();  
          updateStatus('AWAITING CONNECTION');  
          
          // Create the copy button
          const copyBtn = document.createElement('button');
          copyBtn.id = 'copyLinkBtn';
          copyBtn.className = 'copy-btn glass';
          copyBtn.innerHTML = '<i class="fas fa-copy"></i> Copy Call Link';
          connectionInfo.innerHTML = '';
          connectionInfo.appendChild(copyBtn);
          
          // Add event listener to the button
          copyBtn.addEventListener('click', () => {
            const link = `${window.location.href.split('?')[0]}?code=${generatedPeerId}`;  
            navigator.clipboard.writeText(link).then(() => {  
              showNotification('Call link copied to clipboard!');  
            }).catch(err => {  
              console.error('Copy failed:', err);  
              showNotification('Failed to copy link');  
            }); 
          });

          peer = new Peer(generatedPeerId, {  
            secure: true,  
            host: '0.peerjs.com',  
            port: 443  
          });  

          peer.on('open', () => {  
            updateStatus('READY');  
            spinner.style.display = 'none';  
          });  

          peer.on('call', call => {  
            call.answer(localStream);  
            currentCall = call;  
            updateStatus('', true);  
            connectionInfo.innerHTML = '';  
            startTimer();  
            triggerVibration();  
            spinner.style.display = 'none';  

            call.on('stream', stream => {  
              remoteStream = stream;  
              remoteVideo.srcObject = remoteStream;  
              setupCloseDataConnection(call.peer);  
            });  

            call.on('close', () => {  
              updateStatus('DISCONNECTED');  
              stopTimer();  
              setTimeout(() => {  
                window.close();  
              }, 500);  
            });  

            call.on('error', (err) => {  
              console.error('Call error:', err);  
              updateStatus('CALL ERROR');  
              connectionInfo.innerHTML =  
                `Error: ${err.message || err.type}`;  
              stopTimer();  
              spinner.style.display = 'none';  
            });  
          });  
        }  

        peer.on('error', (err) => {  
          console.error('PeerJS error:', err);  
          updateStatus('PEER ERROR');  
          connectionInfo.innerHTML =  
                `Error: ${err.message || err.type}`;  
          stopTimer();  
          spinner.style.display = 'none';  

          if (code && connectionRetries < MAX_RETRIES) {  
            connectionRetries++;  
            connectionInfo.innerHTML +=  
              `<br>Retrying in 3 seconds (${connectionRetries}/${MAX_RETRIES})...`;  
            setTimeout(() => setupReceiver(code), RETRY_DELAY);  
          }  
        });  

      } catch (err) {  
        console.error('Initialization error:', err);  
        updateStatus('INIT ERROR');  
        connectionInfo.innerHTML =  
          'Failed to initialize. Please refresh the page.';  
        spinner.style.display = 'none';  
      }  
    }  

    function setupReceiver(code) {  
      peer = new Peer({ secure: true, host: '0.peerjs.com', port: 443 });  

      peer.on('open', () => {  
        const call = peer.call(code, localStream);  
        currentCall = call;  
        updateStatus('CONNECTING');  

        call.on('stream', stream => {  
          updateStatus('', true);  
          connectionInfo.innerHTML = '';  
          remoteStream = stream;  
          remoteVideo.srcObject = remoteStream;  
          startTimer();  
          triggerVibration();  
          spinner.style.display = 'none';  
          setupCloseDataConnection(call.peer);  
        });  

        call.on('close', () => {  
          updateStatus('DISCONNECTED');  
          stopTimer();  
          setTimeout(() => {  
            window.close();  
          }, 500);  
        });  

        call.on('error', (err) => {  
          console.error('Call error:', err);  
          updateStatus('CALL ERROR');  
          connectionInfo.innerHTML =  
            `Error: ${err.message || err.type}`;  
          stopTimer();  
          spinner.style.display = 'none';  

          if (connectionRetries < MAX_RETRIES) {  
            connectionRetries++;  
            connectionInfo.innerHTML +=  
              `<br>Retrying in 3 seconds (${connectionRetries}/${MAX_RETRIES})...`;  
            setTimeout(() => setupReceiver(code), RETRY_DELAY);  
          }  
        });  
      });  
    }  

    function generateId() {  
      return Math.random().toString(36).substring(2, 8).toUpperCase();  
    }  

    function setupCloseDataConnection(remoteId) {  
      if (closeConn) {  
        closeConn.close();  
        closeConn = null;  
      }  
      closeConn = peer.connect(remoteId);  

      closeConn.on('open', () => {});  

      closeConn.on('data', data => {  
        if (data === 'close-call') {  
          window.close();  
        }  
      });  

      closeConn.on('error', err => {  
        console.error('DataConnection error:', err);  
      });  
    }  

    function triggerVibration() {  
      if (navigator.vibrate) {  
        navigator.vibrate(180);  
      }  
    }  

    document.getElementById('muteBtn').onclick = () => {  
      isMuted = !isMuted;  
      const audioTracks = localStream.getAudioTracks();  
      if (audioTracks.length > 0) {  
        audioTracks[0].enabled = !isMuted;  
      }  
      const micIcon = document.querySelector('#muteBtn i');  
      if (isMuted) {  
        micIcon.className = 'fas fa-microphone-slash';  
        document.getElementById('muteBtn').style.background = 'rgba(200, 30, 50, 0.9)';  
      } else {  
        micIcon.className = 'fas fa-microphone';  
        document.getElementById('muteBtn').style.background = 'rgba(20, 24, 36, 0.85)';  
      }  
    };  

    document.getElementById('switchCameraBtn').onclick = async () => {  
      try {  
        currentCamera = currentCamera === 'user' ? 'environment' : 'user';  
        const newStream = await getMedia(currentCamera);  
        const videoTrack = newStream.getVideoTracks()[0];  

        if (currentCall && currentCall.peerConnection) {  
          const sender = currentCall.peerConnection.getSenders()  
            .find(s => s.track.kind === 'video');  
          if (sender) sender.replaceTrack(videoTrack);  
        }  

        const audioTracks = newStream.getAudioTracks();  
        if (audioTracks.length > 0) {  
          audioTracks[0].enabled = !isMuted;  
        }  

        localVideo.srcObject = newStream;  
        localStream.getTracks().forEach(track => track.stop());  
        localStream = newStream;  
      } catch (err) {  
        console.error('Error switching camera:', err);  
        connectionInfo.innerHTML =  
          'Error switching camera. Please try again.';  
      }  
    };  

    document.getElementById('endBtn').onclick = () => {  
      if (closeConn && closeConn.open) {  
        closeConn.send('close-call');  
      }  
      if (currentCall) {  
        currentCall.close();  
      }  
      if (peer) {  
        peer.destroy();  
      }  
      updateStatus('ENDING CALL');  
      stopTimer();  
      setTimeout(() => {  
        window.close();  
      }, 200);  
    };  

    fullscreenBtn.addEventListener('click', () => {  
      if (!document.fullscreenElement) {  
        document.documentElement.requestFullscreen();  
        fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i>';  
      } else {  
        document.exitFullscreen();  
        fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i>';  
      }  
    });
    
    // Audio processing controls
    noiseSuppression.addEventListener('input', updateAudioProcessing);
    voiceClarity.addEventListener('input', updateAudioProcessing);
    bassBoost.addEventListener('input', updateAudioProcessing);
    
    // Preset buttons
    presetButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        applyAudioProfile(btn.dataset.preset);
      });
    });

    // Initialize audio processing
    noiseSuppression.value = 85;
    voiceClarity.value = 90;
    bassBoost.value = 20;
    updateAudioProcessing();
    
    // Initialize the app
    init();
  </script>  
</body>  
</html>
